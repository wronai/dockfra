# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ssh-autopilot â€” Autonomous Orchestrator
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Run from repo root:  make -f management/ssh-autopilot/Makefile <target>
# Or: cd management/ssh-autopilot && make <target>
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CONTAINER  ?= dockfra-ssh-autopilot
ROLE_USER  ?= autopilot
SSH_PORT   ?= 2203
SSH        := ssh $(ROLE_USER)@localhost -p $(SSH_PORT) -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null
EXEC       := docker exec -u $(ROLE_USER) $(CONTAINER) bash -lc

.DEFAULT_GOAL := help

.PHONY: help
help: ## Show available commands
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘              ğŸ¤– AUTOPILOT â€” Autonomous Orchestrator          â•‘"
	@echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
	@echo "â•‘  make shell               â€” Interactive SSH session          â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘  Commands:                                                   â•‘"
	@echo "â•‘    make pilot-status                                         â•‘"
	@echo "â•‘    make pilot-run                                            â•‘"
	@echo "â•‘    make pilot-plan                                           â•‘"
	@echo "â•‘    make pilot-log                                            â•‘"
	@echo "â•‘                                                              â•‘"
	@echo "â•‘  Ticket Orchestration:                                       â•‘"
	@echo "â•‘    make ticket-list                                          â•‘"
	@echo "â•‘    make create-from-plan                                     â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""

.PHONY: shell
shell: ## Open interactive SSH session
	@$(SSH)

.PHONY: pilot-status
pilot-status: ## Show autopilot decisions & state
	@$(EXEC) "pilot-status"

.PHONY: pilot-run
pilot-run: ## Trigger one autopilot cycle manually
	@$(EXEC) "pilot-run"

.PHONY: pilot-plan
pilot-plan: ## Generate project plan via LLM
	@$(EXEC) "pilot-plan"

.PHONY: pilot-log
pilot-log: ## Watch autopilot daemon log (live)
	@$(EXEC) "tail -f /var/log/autopilot.log"

.PHONY: ticket-list
ticket-list: ## List all tickets
	@$(EXEC) "tickets list"

.PHONY: create-from-plan
create-from-plan: ## Create tickets from LLM plan
	@$(EXEC) "create-from-plan"

.PHONY: logs
logs: ## Tail autopilot container logs
	@docker logs -f $(CONTAINER)
